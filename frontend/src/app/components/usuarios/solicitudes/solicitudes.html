<div class="wrapper-solicitudes">
  <app-header></app-header>

  <main class="app-container no-scroll">
    <div class="solicitudes-wrapper">
      <div class="header-gestion">
        <div class="section-title-modern">
          <h2>Gestión de Solicitudes</h2>
        </div>

        <div class="info-alert-modern">
          <div class="info-icon">
            <i class="fa-solid fa-circle-info"></i>
          </div>
          <div class="info-text">
            <p>
              Este es tu rincón personal. Aquí verás los pisos que te han flipado y a los que has
              enviado solicitud. Mantente atento: si tienes suerte, el estado cambiará a
              <strong>Aceptado</strong> cuando el propietario quiera conocerte.
            </p>
          </div>
        </div>
      </div>
      <div class="toast-container" *ngIf="exitoDeleteSolicitud" [@enterPost]>
        <div class="toast-card toast-danger">
          <div class="toast-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="3 6 5 6 21 6"></polyline>
              <path
                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
              ></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </div>
          <div class="toast-content">
            <span class="toast-title">¡Solicitud quitada!</span>
            <p class="toast-message">Hemos actualizado tu panel correctamente.</p>
          </div>
          <button class="toast-close" (click)="exitoDeleteSolicitud = false">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>

      <section class="main-card solicitudes-card full-screen-layout">
        <div *ngIf="loading" class="loader"></div>
        <ng-container *ngIf="!loading">
          <select [(ngModel)]="valorEstado" (change)="filterEstado()" class="custom-select">
            <option value="todos">Todos</option>
            <option value="interesado">Interesado</option>
            <option value="aceptado">Aceptado</option>
            <option value="rechazado">Rechazado</option>
          </select>
          <div *ngIf="inmuebles.length === 0 && !noInfo" class="div-info-estado">
            <i class="fa-regular fa-clock" *ngIf="valorEstado === 'aceptado'"></i>
            <i class="fa-regular fa-face-smile-wink" *ngIf="valorEstado === 'rechazado'"></i>

            <div>
              <p *ngIf="valorEstado === 'aceptado'">Paciencia, aún están revisando tu perfil.</p>
              <p *ngIf="valorEstado === 'rechazado'">
                ¡Buenas noticias! De momento, cero rechazos.
              </p>
              <p *ngIf="valorEstado === 'interesado'">
                Aún no has mostrado interés por ningún inmueble. ¿Empezamos la búsqueda?
              </p>
              
            </div>
          </div>
          <div class="column-grid-scroll" *ngIf="!noInfo; else elseBlock">
            <article class="house-card-modern" *ngFor="let inm of inmuebles" [@enterInfo]>
              <div class="card-image-box">
                <img [src]="urlImagenes + inm.imagen_principal" alt="Piso" />
                <div class="card-tag">{{ inm.estado_solicitud }}</div>
              </div>
              <div class="card-body">
                <div class="card-header-info">
                  <h3 class="house-name">{{ inm.titulo }}</h3>
                  <span class="precio">{{ inm.precio }}€</span>
                </div>
                <div class="card-footer">
                  <span class="location"
                    ><i class="fa-solid fa-location-dot"></i> {{ inm.direccion }}</span
                  >
                  <div class="card-options"><button
                    class="view-btn"
                    routerLink="/piso-detalle"
                    [routerLink]="'/piso-detalle/' + inm.inmueble_id"
                  >
                    <i class="fa-regular fa-eye"></i>
                  </button>
                  <button
                    class="delete-sol-btn"
                    *ngIf="inm.estado_solicitud === 'rechazado'"
                    (click)="quitarSolicitud(inm.solicitud_id)"
                    title="Eliminar de mi lista"
                  >
                    <i class="fa-solid fa-trash-can"></i>
                  </button></div>
                  
                </div>
              </div>
            </article>
          </div>
          <div class="pagination" *ngIf="mostratPaginacion">
            <button class="pag-btn prev" [disabled]="currentPage === 1" (click)="prevPage()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"
                />
              </svg>
              Anterior
            </button>

            <button class="pag-number active" (click)="goToPage(currentPage)">
              {{ currentPage }}
            </button>
            <div *ngIf="totalPages > 1" style="display: flex; gap: 5px">
              <button
                class="pag-number"
                *ngIf="currentPage !== totalPages"
                (click)="goToPage(currentPage + 1)"
              >
                {{ currentPage + 1 }}
              </button>
              <span class="pag-dots">...</span>

              <button
                class="pag-number"
                *ngIf="currentPage !== totalPages"
                (click)="goToPage(totalPages)"
              >
                {{ totalPages }}
              </button>
            </div>

            <button
              class="pag-btn next"
              [disabled]="currentPage === totalPages"
              (click)="nextPage()"
            >
              Siguiente
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"
                />
              </svg>
            </button>
          </div>
        </ng-container>

        <ng-template #elseBlock>
          <div class="no-info-container solicitudes-empty">
            <img src="/assets/img/sad-house.png" alt="Sin solicitudes" class="sad-img" />
            <div class="info-text">
              <h2 class="gradient-text">¡Vaya!</h2>
              <p class="main-message">
                Aún no has enviado ninguna solicitud. ¡No te quedes sin tu piso ideal!
              </p>
              <p class="sub-message">
                Explora las casas disponibles y dale al corazón para que aparezcan aquí.
              </p>
              <button class="btn-primary" routerLink="/home-estudiante">Explorar pisos</button>
            </div>
          </div>
        </ng-template>
      </section>
    </div>
  </main>
</div>
