<section class="profile-section">
  <div class="app-container">
    <div class="profile-container">
      <div class="profile-main-card" @enterPerfil *ngIf="perfil">
        <div class="profile-header">
          <div class="avatar-wrapper">
            <div class="profile-img">
              <img
                [src]="
                  userData.userPhoto.includes('data:')
                    ? userData.userPhoto
                    : './assets/img/avatar_default.png'
                "
              />
            </div>
            <input
              type="file"
              #fileInput
              style="display: none"
              accept="image/*"
              (change)="nombreFoto($event)"
            />
            <button type="button" class="btn-edit-photo" (click)="fileInput.click()">
              <i class="fa-solid fa-camera"></i>
            </button>
          </div>

          <div class="profile-intro">
            <h2>{{ userName }}</h2>
            <p class="perfil-p">
              {{
                perfil.data.rol === 'estudiante'
                  ? 'Completa tu perfil para empezar'
                  : 'Configura tu perfil de Propietario'
              }}
            </p>
            <p class="p-description">
              {{
                perfil.data.rol === 'estudiante'
                  ? 'Te recomendamos que subas una foto. A menos que seas Batman y quieras proteger tu identidad...'
                  : 'Una foto profesional transmite confianza a los estudiantes que soliciten tus inmuebles.'
              }}
            </p>
          </div>
        </div>

        <div class="profile-form-grid">
          <div class="input-group">
            <label>Nombre Completo</label>
            <p class="p-userInfo">{{ userName }}</p>
          </div>

          <div class="input-group">
            <label>Correo Electrónico</label>
            <p class="p-userInfo">{{ userEmail }}</p>
          </div>

          <div class="input-group">
            <label>Teléfono</label>
            <input
              type="text"
              placeholder="600 000 000"
              [(ngModel)]="userData.userPhone"
              (ngModelChange)="validacionTelefono()"
            />
            <div *ngIf="userData.userPhone.length >= 1">
              <p class="phone-valid" *ngIf="telefonoValido; else elsePhone">Teléfono válido</p>
              <ng-template #elsePhone>
                <p class="phone-noValid">Teléfono no válido</p>
              </ng-template>
            </div>
          </div>

          <ng-container *ngIf="perfil.data.rol === 'estudiante'">
            <div class="input-group">
              <label>Grado / Carrera</label>
              <select
                class="select-uni"
                [(ngModel)]="userData.userCareer"
                (ngModelChange)="validacionCarrera()"
              >
                <option value="" disabled selected>Selecciona tu carrera</option>
                <option *ngFor="let car of carreras" [value]="car.id">{{ car.nombre }}</option>
              </select>
            </div>

            <div class="input-group full-width">
              <div class="info-description">
                <label>Acerca de ti (Máx 200 caracteres)</label>
                <div *ngIf="userData.userDescription.length > 1" class="info-description-text">
                  <p *ngIf="userData.userDescription.length < 10">Algo más puedes poner de ti...</p>
                  <p
                    *ngIf="
                      userData.userDescription.length >= 10 &&
                      userData.userDescription.length <= 200
                    "
                  >
                    Así perfecto
                  </p>
                  <p *ngIf="userData.userDescription.length > 200">Escribe un poco menos</p>
                </div>
              </div>
              <textarea
                (input)="validacionDescripcion()"
                placeholder="Cuéntanos un poco sobre ti... (hobbies, manías, qué buscas)"
                [(ngModel)]="userData.userDescription"
              ></textarea>
            </div>

            <div class="input-group">
              <label>Universidad</label>
              <select
                class="select-uni"
                [(ngModel)]="userData.userUni"
                (ngModelChange)="validacionUniversidad()"
              >
                <option value="" disabled selected>Selecciona tu universidad</option>
                <option *ngFor="let uni of unis" [value]="uni.id">
                  {{ uni.siglas }} - {{ uni.nombre }}
                </option>
              </select>
            </div>

            <div class="info-uni">
              <div class="info-uni-icon"><i class="fa-solid fa-circle-info"></i></div>
              <div class="info-uni-content">
                <h4>¿Por qué pedimos tu universidad?</h4>
                <p>
                  Necesitamos saber dónde estudias para mostrarte los alojamientos más cercanos.
                </p>
              </div>
            </div>
          </ng-container>

          <ng-container *ngIf="perfil.data.rol === 'propietario'">
            <div class="input-group full-width">
              <div class="info-description">
                <label>Acerca de ti (Máx 200 caracteres)</label>
                <div *ngIf="userData.userDescription.length > 1" class="info-description-text">
                  <p *ngIf="userData.userDescription.length < 10">Algo más puedes poner de ti...</p>
                  <p
                    *ngIf="
                      userData.userDescription.length >= 10 &&
                      userData.userDescription.length <= 200
                    "
                  >
                    Así perfecto
                  </p>
                  <p *ngIf="userData.userDescription.length > 200">Escribe un poco menos</p>
                </div>
              </div>
              <textarea
                placeholder="Cuéntale a los estudiantes cómo eres gestionando tus pisos o tu disponibilidad para visitas..."
                [(ngModel)]="userData.userDescription"
                (input)="validacionDescripcion()"
              ></textarea>
            </div>

            <div class="info-uni owner-info">
              <div class="info-uni-icon"><i class="fa-solid fa-shield-halved"></i></div>
              <div class="info-uni-content">
                <h4>Privacidad de datos</h4>
                <p>
                  Tu teléfono solo será visible para los estudiantes cuyas solicitudes hayas
                  aceptado previamente.
                </p>
              </div>
            </div>
          </ng-container>

          <button class="complete-profile" (click)="postDatos()" [disabled]="!permitirPostDatos">
            Completar Perfil
          </button>
        </div>
      </div>

      <aside
        class="profile-sidebar-card"
        @enterSideBar
        *ngIf="perfil && perfil.data.rol === 'estudiante'"
      >
        <div class="sidebar-header">
          <h3>Vibe & Estilo de Vida</h3>
          <span class="counter">{{ atributosUsuario.length }}</span>
        </div>
        <div class="attributes-container" *ngIf="atributosUsuarioObject">
          <span class="attribute-pill" *ngFor="let atr of atributosUsuarioObject">
            <i class="material-symbols-outlined">{{ atr.icono }}</i> {{ atr.nombre }}
          </span>
        </div>
      </aside>

      <aside
        class="profile-sidebar-card owner-sidebar-preview"
        @enterSideBar
        *ngIf="perfil && perfil.data.rol === 'propietario'"
      >
        <div class="preview-content">
          <div class="icon-circle">
            <i class="fa-solid fa-house-laptop"></i>
          </div>
          <h3>Tu Listado de Casas Para el Mundo</h3>
          <p>Una vez completes tu perfil, aquí aparecerá el listado de tus casas</p>

          <div class="preview-mockup">
            <div class="mock-line"></div>
            <div class="mock-line short"></div>
            <div class="mock-line"></div>
          </div>

          <span class="badge-status">MODO REGISTRO</span>
        </div>
      </aside>
    </div>
  </div>
</section>
